// === DATA BAHASA (HANYA UI, KESAN/PESAN SISWA DIAMBIL DARI HTML) ===
const translations = {
    id: {
        mainTitle: "Kenang-kenangan Kelas 9G",
        graduationYear: "Angkatan 2024-2025", // GANTI TAHUN
        schoolName: "SMPN 32 Semarang",      // GANTI NAMA SEKOLAH
        clickHint: "(Klik pada foto siswa untuk melihat pesan mereka)",
        schoolLogoAlt: "Logo SMPN 32 Semarang", // GANTI NAMA SEKOLAH
        schoolBuildingAlt: "Gedung SMPN 32 Semarang", // GANTI NAMA SEKOLAH
        welcomeToSchoolMemories: "Selamat Datang di Kenangan SMPN 32 Semarang", // GANTI NAMA SEKOLAH
        memoriesBeginHere: "Tempat di mana cerita kita dimulai dan kenangan indah terukir.",
        welcomeTo9GPage: "Selamat datang di halaman kenangan",
        clickFriendPhoto: "Klik foto temanmu untuk membaca pesan dan kesan mereka.",
        memoriesWithStudents: "Kenangan indah ini tercipta bersama",
        studentsText: "siswa",
        greatStudents: "hebat",
        homeroomTeacher: "Wali Kelas",
        viewGroupPhotosButton: "Foto Bersama", // Tombol di index.html
        googledrive: "foto perpisahan (google drive)",
        galleryPageTitle: "Galeri Foto Bersama Kelas 9G", // Judul di galeri.html
        backToMainPageButton: "&laquo; Kembali ke Halaman Utama", // Tombol di galeri.html
        groupPhotosTitle: "Foto-foto Kenangan Bersama", // Judul galeri di galeri.html
        // === ISI KETERANGAN FOTO BERSAMA DI SINI (CONTOH) ===
        classPhotoAlt1: "Foto Bersama 1", 
        classPhotoCaption1: "Foto bersama di depan kelas, momen study tour!", // Contoh terisi
        classPhotoAlt2: "Foto Bersama 2",
        classPhotoCaption2: "[Isi Keterangan Foto Bersama 2 - ID]",
        classPhotoAlt3: "Foto Bersama 3",
        classPhotoCaption3: "[Isi Keterangan Foto Bersama 3 - ID]",
        classPhotoAlt4: "Foto Bersama 4",
        classPhotoCaption4: "[Isi Keterangan Foto Bersama 4 - ID]",
        classPhotoAlt5: "Foto Bersama 5",
        classPhotoCaption5: "[Isi Keterangan Foto Bersama 5 - ID]",
        classPhotoAlt6: "Foto Bersama 6",
        classPhotoCaption6: "[Isi Keterangan Foto Bersama 6 - ID]",
        classPhotoAlt7: "Foto Bersama 7",
        classPhotoCaption7: "[Isi Keterangan Foto Bersama 7 - ID]",
        classPhotoAlt8: "Foto Bersama 8",
        classPhotoCaption8: "[Isi Keterangan Foto Bersama 8 - ID]",
        classPhotoAlt9: "Foto Bersama 9",
        classPhotoCaption9: "[Isi Keterangan Foto Bersama 9 - ID]",
        classPhotoAlt10: "Foto Bersama 10",
        classPhotoCaption10: "[Isi Keterangan Foto Bersama 10 - ID]",
        classPhotoAlt11: "Foto Bersama 11",
        classPhotoCaption11: "[Isi Keterangan Foto Bersama 11 - ID]",
        classPhotoAlt12: "Foto Bersama 12",
        classPhotoCaption12: "[Isi Keterangan Foto Bersama 12 - ID]",
        classPhotoAlt13: "Foto Bersama 13",
        classPhotoCaption13: "[Isi Keterangan Foto Bersama 13 - ID]",
        classPhotoAlt14: "Foto Bersama 14",
        classPhotoCaption14: "[Isi Keterangan Foto Bersama 14 - ID]",
        classPhotoAlt15: "Foto Bersama 15",
        classPhotoCaption15: "[Isi Keterangan Foto Bersama 15 - ID]",
        classPhotoAlt16: "Foto Bersama 16",
        classPhotoCaption16: "[Isi Keterangan Foto Bersama 16 - ID]",
        classPhotoAlt17: "Foto Bersama 17",
        classPhotoCaption17: "[Isi Keterangan Foto Bersama 17 - ID]",
        classPhotoAlt18: "Foto Bersama 18",
        classPhotoCaption18: "[Isi Keterangan Foto Bersama 18 - ID]",
        classPhotoAlt19: "Foto Bersama 19",
        classPhotoCaption19: "[Isi Keterangan Foto Bersama 19 - ID]",
        studentGalleryTitle: "Galeri Siswa Kelas 9G",
        settingsTitle: "Pengaturan Tampilan",
        languageLabel: "Bahasa:",
        toggleThemeButton: "Ubah ke Tema Gelap",
        settingsButton: "Pengaturan",
        schoolNameFooter: "SMPN 32 Semarang", // GANTI NAMA SEKOLAH
        modalKesanLabel: "Kesan:",
        modalPesanLabel: "Pesan:",
        modalNoMessage: "Belum ada pesan atau kesan dari siswa ini. hubungi developer untuk menambahkan pesan atau kesan disini"
    },
    en: { 
        mainTitle: "Class 9G Memories",
        graduationYear: "Graduating Class of 2024-2025",
        schoolName: "SMPN 32 Semarang", 
        clickHint: "(Click on a student's photo to see their message)",
        schoolLogoAlt: "SMPN 32 Semarang Logo",
        schoolBuildingAlt: "SMPN 32 Semarang Building",
        welcomeToSchoolMemories: "Welcome to SMPN 32 Semarang Memories",
        memoriesBeginHere: "The place where our stories began and beautiful memories were made.",
        welcomeTo9GPage: "Welcome to the Class 9G memories page",
        clickFriendPhoto: "Click on your friend's photo to read their messages and impressions.",
        memoriesWithStudents: "Beautiful memories created with",
        studentsText: "students",
        greatStudents: "great",
        homeroomTeacher: "Homeroom Teacher",
        viewGroupPhotosButton: "Group Photo",
        googledrive: "farewell photos (google drive)",
        galleryPageTitle: "Class 9G Group Photo Gallery",
        backToMainPageButton: "&laquo; Back to Main Page",
        groupPhotosTitle: "Group Memory Photos",
        classPhotoAlt1: "Group Photo 1",
        classPhotoCaption1: "Group photo in front of the classroom, a study tour moment!", // Example translated
        classPhotoAlt2: "Group Photo 2",
        classPhotoCaption2: "[Translate Group Photo Caption 2 to EN]",
        // ... Translate all 19 captions and alt texts
        classPhotoAlt19: "Group Photo 19",
        classPhotoCaption19: "[Translate Group Photo Caption 19 to EN]",
        studentGalleryTitle: "Class 9G Student Gallery",
        settingsTitle: "Display Settings",
        languageLabel: "Language:",
        toggleThemeButton: "Switch to Dark Theme",
        settingsButton: "Settings",
        schoolNameFooter: "SMPN 32 Semarang",
        modalKesanLabel: "Impressions:",
        modalPesanLabel: "Messages:",
        modalNoMessage: "No message or impression from this student yet. Contact the developer to add a message or impression here."
    },
    ms: { 
        mainTitle: "Kenangan Kelas 9G",
        graduationYear: "Angkatan 2024-2025",
        schoolName: "SMPN 32 Semarang", 
        clickHint: "(Klik pada foto pelajar untuk melihat mesej mereka)",
        schoolLogoAlt: "Logo SMPN 32 Semarang",
        schoolBuildingAlt: "Bangunan SMPN 32 Semarang",
        welcomeToSchoolMemories: "Selamat Datang ke Kenangan SMPN 32 Semarang",
        memoriesBeginHere: "Tempat di mana cerita kita bermula dan kenangan indah terukir.",
        welcomeTo9GPage: "Selamat datang ke halaman kenangan Kelas 9G",
        clickFriendPhoto: "Klik foto rakan anda untuk membaca mesej dan kesan mereka.",
        memoriesWithStudents: "Kenangan indah tercipta bersama",
        studentsText: "pelajar",
        greatStudents: "hebat",
        homeroomTeacher: "Guru Kelas",
        viewGroupPhotosButton: "Foto Bersama",
        googledrive: "gambar perpisahan (google drive)",
        galleryPageTitle: "Galeri Foto Bersama Kelas 9G",
        backToMainPageButton: "&laquo; Kembali ke Halaman Utama",
        groupPhotosTitle: "Foto-foto Kenangan Bersama",
        classPhotoAlt1: "Foto Bersama 1",
        classPhotoCaption1: "Gambar berkumpulan di hadapan kelas, detik lawatan sambil belajar!", // Contoh terjemahan
        classPhotoAlt2: "Foto Bersama 2",
        classPhotoCaption2: "[Terjemahkan Keterangan Foto Bersama 2 ke MS]",
        classPhotoAlt19: "Foto Bersama 19",
        classPhotoCaption19: "[Terjemahkan Keterangan Foto Bersama 19 ke MS]",
        studentGalleryTitle: "Galeri Pelajar Kelas 9G",
        settingsTitle: "Tetapan Paparan",
        languageLabel: "Bahasa:",
        toggleThemeButton: "Tukar ke Tema Gelap",
        settingsButton: "Tetapan",
        schoolNameFooter: "SMPN 32 Semarang",
        modalKesanLabel: "Kesan:",
        modalPesanLabel: "Mesej:",
        modalNoMessage: "Belum ada mesej atau kesan daripada pelajar ini. Hubungi pembangun untuk menambah mesej atau kesan di sini."
    }
};

document.addEventListener('DOMContentLoaded', function () {
    const htmlElement = document.documentElement;
    const themeToggleButton = document.getElementById('themeToggle');
    const settingsButton = document.getElementById('settingsButton');
    const settingsPanel = document.getElementById('settingsPanel');
    const closeSettingsPanelButton = document.getElementById('closeSettingsPanel');
    const languageSelector = document.getElementById('languageSelector');

    const studentCards = document.querySelectorAll('.student-card');
    const modal = document.getElementById('studentModal');
    const modalImg = document.getElementById('modalImg');
    const modalName = document.getElementById('modalName');
    const modalMessage = document.getElementById('modalMessage');
    const closeModalButton = modal ? modal.querySelector('.close-button') : null;

    let currentTheme = localStorage.getItem('theme') || 'light';
    let currentLang = localStorage.getItem('language') || 'id';

    function applyTheme(theme) {
        htmlElement.setAttribute('data-theme', theme);
        localStorage.setItem('theme', theme);
        currentTheme = theme;
        updateThemeButtonText();
    }

    function updateThemeButtonText() {
        const langPack = translations[currentLang] || translations.id;
        let baseText;
        if (currentTheme === 'dark') {
            if (currentLang === 'id') baseText = "Ubah ke Tema Terang";
            else if (currentLang === 'ms') baseText = "Tukar ke Tema Cerah";
            else baseText = "Switch to Light Theme";
        } else {
            if (currentLang === 'id') baseText = "Ubah ke Tema Gelap";
            else if (currentLang === 'ms') baseText = "Tukar ke Tema Gelap";
            else baseText = "Switch to Dark Theme";
        }
        if(themeToggleButton) themeToggleButton.textContent = baseText;
    }

    function setLanguage(lang) {
        if (!translations[lang]) {
            console.warn(`Language pack for "${lang}" not found. Defaulting to 'id'.`);
            lang = 'id';
        }
        htmlElement.lang = lang;
        currentLang = lang;
        localStorage.setItem('language', lang);
        const langPack = translations[lang];

        document.querySelectorAll('[data-translate], [data-translate-alt]').forEach(el => {
            const key = el.dataset.translate || el.dataset.translateAlt;
            const translatedText = langPack[key];

            if (translatedText !== undefined) {
                 if (el.hasAttribute('data-translate-alt') || (el.tagName === 'IMG' && key.endsWith('Alt'))) {
                     el.alt = translatedText;
                } else {
                    el.innerHTML = translatedText;
                }
            } else {
                 // console.warn(`Translation key "${key}" not found for language "${lang}".`);
            }
        });
        updateThemeButtonText();
    }

    if (studentCards.length > 0 && modal && closeModalButton) {
        function openStudentModal(card) {
            const nama = card.dataset.nama;
            const foto = card.dataset.foto;
            const kesanText = card.dataset.kesan || "";
            const pesanText = card.dataset.pesan || "";
            const quoteText = card.dataset.quote || "";

            modalImg.src = foto;
            const studentNameForAlt = nama.startsWith("[NAMA SISWA") ? "Siswa" : nama;
            modalImg.alt = `Foto ${studentNameForAlt}`;
            modalName.textContent = nama;

            let messageHTML = '';
            const langPack = translations[currentLang] || translations.id;

            if (kesanText.trim() !== "" && !kesanText.startsWith("[KESAN SISWA")) {
                messageHTML += `<p><strong>${langPack.modalKesanLabel || 'Kesan:'}</strong> ${kesanText}</p>`;
            }
            if (pesanText.trim() !== "" && !pesanText.startsWith("[PESAN SISWA")) {
                messageHTML += `<p><strong>${langPack.modalPesanLabel || 'Pesan:'}</strong> ${pesanText}</p>`;
            }
            if (quoteText.trim() !== "" && !quoteText.startsWith("[QUOTE SISWA")) {
                messageHTML += `<p><em>"${quoteText}"</em></p>`;
            }

            if (messageHTML.trim() === "") {
                messageHTML = `<p><em>${langPack.modalNoMessage || 'Belum ada pesan atau kesan dari siswa ini.'}</em></p>`;
            }
            modalMessage.innerHTML = messageHTML;

            modal.classList.add('active');
            document.body.classList.add('modal-open');
        }

        function closeStudentModal() {
            modal.classList.remove('active');
            if (!settingsPanel || !settingsPanel.classList.contains('active')) {
                document.body.classList.remove('modal-open');
            }
        }

        studentCards.forEach(card => {
            const clickableElement = card.querySelector('img, .placeholder-img');
            if (clickableElement) clickableElement.addEventListener('click', () => openStudentModal(card));
        });
        closeModalButton.addEventListener('click', closeStudentModal);
    }

    // Event Listeners Umum
    if (themeToggleButton) themeToggleButton.addEventListener('click', () => applyTheme(currentTheme === 'light' ? 'dark' : 'light'));
    if (settingsButton && settingsPanel && closeSettingsPanelButton) {
        settingsButton.addEventListener('click', () => { settingsPanel.classList.add('active'); document.body.classList.add('modal-open'); });
        closeSettingsPanelButton.addEventListener('click', () => {
            settingsPanel.classList.remove('active');
            if (!modal || !modal.classList.contains('active')) document.body.classList.remove('modal-open');
        });
    }
    if (languageSelector) languageSelector.addEventListener('change', (e) => setLanguage(e.target.value));

    window.addEventListener('click', function (event) {
        if (modal && event.target === modal) closeStudentModal(); // Hanya jika modal ada
        if (settingsPanel && event.target === settingsPanel) {
            settingsPanel.classList.remove('active');
            if (!modal || !modal.classList.contains('active')) document.body.classList.remove('modal-open');
        }
    });
    window.addEventListener('keydown', function (event) {
        if (event.key === 'Escape') {
            if (settingsPanel && settingsPanel.classList.contains('active')) {
                settingsPanel.classList.remove('active');
                if (!modal || !modal.classList.contains('active')) document.body.classList.remove('modal-open');
            } else if (modal && modal.classList.contains('active')) closeStudentModal();
        }
    });

    // Apply initial settings
    applyTheme(currentTheme);
    setLanguage(currentLang);
    if(languageSelector) languageSelector.value = currentLang;
});